<app-headbar></app-headbar>

<div class="test-container">
  <h1>游닇 Test Completo - SSII</h1>
  <p>Responde a todas las preguntas sin divisi칩n por temas.</p>

  <!-- Recorremos las preguntas que est치n en la p치gina actual -->
  <div *ngFor="let pregunta of preguntasPaginadas; let i = index" class="p-card mt-3">
      
      <div class="p-card-header">
          <!-- Mostramos el n칰mero global de la pregunta, 
               sumando la base de paginaActual * preguntasPorPagina 
               m치s el 칤ndice local (i + 1) -->
          <h3>{{ (paginaActual * preguntasPorPagina) + (i + 1) }}. {{ pregunta.pregunta }}</h3>
      </div>

      <p-divider></p-divider>

      <div class="p-card-body">
          <!-- Recorremos todas las respuestas de la pregunta -->
          <div *ngFor="let respuesta of pregunta.respuestas" class="respuesta-item">

              <!-- Input radio, desactivado si la p치gina ya est치 corregida o el test est치 finalizado -->
              <p-radioButton 
                name="pregunta{{ i }}" 
                [value]="respuesta" 
                [(ngModel)]="pregunta.seleccionada"
                [disabled]="paginaComprobada || testFinalizado">
              </p-radioButton>

              <label>{{ respuesta }}</label>

              <!-- Solo mostramos iconos si la p치gina est치 corregida (paginaComprobada=true) -->
              <ng-container *ngIf="paginaComprobada || testFinalizado">
                <!-- 1) Check verde si el usuario seleccion칩 la respuesta correcta -->
                <i 
                  *ngIf="pregunta.seleccionada === respuesta && respuesta === pregunta.correcta"
                  class="pi pi-check text-success ml-2">
                </i>

                <!-- 2) Aspa roja si el usuario seleccion칩 una respuesta incorrecta -->
                <i 
                  *ngIf="pregunta.seleccionada === respuesta && respuesta !== pregunta.correcta"
                  class="pi pi-times text-danger ml-2">
                </i>

                <!-- 3) Check azul (o el color que quieras) en la respuesta correcta 
                     cuando el usuario NO la seleccion칩 -->
                <i
                  *ngIf="pregunta.seleccionada !== respuesta && respuesta === pregunta.correcta"
                  class="pi pi-check text-primary ml-2">
                </i>
              </ng-container>
          </div>

          <!-- Mostrar mensaje global (correcto / incorrecto) asignado en tu l칩gica de correcci칩n -->
          <p-messages
            *ngIf="paginaComprobada || testFinalizado" 
            [(value)]="pregunta.mensajeRespuesta"
            [closable]="false"
            class="mt-3">
          </p-messages>
      </div>
  </div>

  <!-- Paginador de PrimeNG: controla la navegaci칩n de p치ginas -->
  <p-paginator 
    [rows]="preguntasPorPagina" 
    [totalRecords]="preguntasActuales.length" 
    (onPageChange)="cambiarPagina($event)">
  </p-paginator>

  <div class="button-container mt-4">
    <!-- Bot칩n para corregir SOLO la p치gina actual -->
    <button 
      pButton 
      label="Corregir P치gina" 
      icon="pi pi-check" 
      (click)="corregirPagina()" 
      [disabled]="paginaComprobada || testFinalizado">
    </button>

    <!-- Bot칩n para finalizar todo el test -->
    <button 
      pButton 
      label="Finalizar Test" 
      icon="pi pi-check" 
      class="pink-button ml-2"
      (click)="finalizarTest()" 
      [disabled]="testFinalizado">
    </button>
  </div>

  <!-- Bot칩n para volver a la anterior (o al men칰 de SSII) -->
  <button 
    pButton 
    label="Volver a SSII" 
    class="p-button-outlined mt-4" 
    (click)="goBack()">
  </button>

  <!-- ConfirmDialog de PrimeNG para mensajes de confirmaci칩n / resultados -->
  <p-confirmDialog></p-confirmDialog>
</div>
